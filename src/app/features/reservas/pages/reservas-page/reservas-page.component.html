<div class="reservas-container">
  <div class="header">
    <h1>Gestionar Reservas</h1>
    <p class="subtitle">Vista de disponibilidad por cancha y horario</p>
  </div>

  <div class="offline-message" *ngIf="!isComplexOnline">
    <mat-icon>cloud_off</mat-icon>
    <h2>Complejo Offline</h2>
    <p>
      El complejo está actualmente fuera de línea. No se pueden crear nuevas
      reservas.
    </p>
  </div>

  <!-- Navegador de fecha + Grilla -->
  <div class="schedule-section" *ngIf="isComplexOnline">
    <!-- Barra de navegación de fecha -->
    <div class="date-navigator">
      <button mat-stroked-button class="today-btn" (click)="goToToday()">
        Hoy
      </button>
      <button mat-icon-button (click)="prevDay()">
        <mat-icon>chevron_left</mat-icon>
      </button>
      <button mat-icon-button (click)="nextDay()">
        <mat-icon>chevron_right</mat-icon>
      </button>
      <mat-icon class="date-icon">calendar_today</mat-icon>
      <span class="current-date">{{
        selectedDate | date: "EEEE d 'de' MMMM"
      }}</span>
    </div>

    <!-- Grilla de horarios -->
    <app-schedule-grid
      [courts]="courts"
      [timeSlots]="timeSlots"
      [reservations]="dayReservations"
      (slotClicked)="onSlotClicked($event)"
      (reservationClicked)="onReservationClicked($event)"
    >
    </app-schedule-grid>
  </div>

  <!-- Última respuesta del backend -->
  <div class="backend-response-card" *ngIf="lastBackendResponse">
    <div class="response-header">
      <mat-icon>cloud_done</mat-icon>
      <h3>Última reserva guardada en el backend</h3>
      <button
        mat-icon-button
        (click)="lastBackendResponse = null"
        class="close-btn"
      >
        <mat-icon>close</mat-icon>
      </button>
    </div>
    <div class="response-body">
      <div class="response-field">
        <strong>ID:</strong> {{ lastBackendResponse.id }}
      </div>
      <div class="response-field">
        <strong>Cancha:</strong> {{ lastBackendResponse.nombreCancha }}
      </div>
      <div class="response-field">
        <strong>Fecha:</strong> {{ lastBackendResponse.dia }}
      </div>
      <div class="response-field">
        <strong>Hora:</strong> {{ lastBackendResponse.hora }}:00
      </div>
      <div class="response-field">
        <strong>Pago:</strong> {{ lastBackendResponse.pago }}
      </div>
      <div class="response-field">
        <strong>Fijo:</strong> {{ lastBackendResponse.fijo ? 'Sí' : 'No' }}
      </div>
      <div class="response-field">
        <strong>Usuario:</strong> {{ lastBackendResponse.nombreUsuario }}
      </div>
      <div class="response-field">
        <strong>Email:</strong> {{ lastBackendResponse.emailUsuario }}
      </div>
      <div class="response-field">
        <strong>Teléfono:</strong> {{ lastBackendResponse.telefonoUsuario }}
      </div>
      <div class="response-field">
        <strong>Creada:</strong> {{ lastBackendResponse.createdAt }}
      </div>
    </div>
    <details class="response-raw">
      <summary>Ver JSON completo</summary>
      <pre>{{ lastBackendResponse | json }}</pre>
    </details>
  </div>
</div>

<!-- Toast Container para deshacer -->
<div class="toast-container">
  <div class="toast" *ngFor="let toast of toasts">
    <span class="toast-message">{{ toast.message }}</span>
    <button class="toast-action" (click)="onUndo(toast)">DESHACER</button>
  </div>
</div>
